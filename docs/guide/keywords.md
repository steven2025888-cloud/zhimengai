# 关键词设置

关键词是系统自动化的核心。通过配置关键词规则，当观众在弹幕中说出特定词汇时，系统会自动触发对应的回复或播放。

## 核心概念

### 什么是关键词分类？

将相关的关键词组织在一起，形成一个"分类"。每个分类对应一个音频文件夹或回复文案。

**示例**：
- 分类名：`价格`
- 对应音频文件夹：`zhubo_audio/价格/`
- 对应回复文案：`这款产品现在有优惠...`

### 四个关键词字段

| 字段 | 用途 | 示例 |
|------|------|------|
| **必含词** | 观众必须说这个词才能触发 | 多少钱、价格、多少 |
| **意图词** | 可选，用于提高匹配精度 | 便宜、贵、优惠 |
| **排除词** | 包含这个词就不触发 | 不要、别、不 |
| **回复词** | 自动回复的文本（可选） | 这款产品现在有优惠... |

---

## 界面说明

### 左侧：分类列表

- **搜索框** - 模糊搜索分类名
- **新建分类** - 创建新的分类
- **重命名** - 修改分类名
- **删除分类** - 删除选中分类
- **删除全部** - 清空所有分类（谨慎操作）

### 右侧：词条编辑

- **当前分类** - 显示选中的分类名
- **四个标签页** - 分别编辑四种词条
- **批量添加** - 一次添加多个词条
- **删除选中** - 删除选中的词条
- **清空当前标签** - 清空当前标签页的所有词条

### 顶部：操作按钮

| 按钮 | 功能 | 说明 |
|------|------|------|
| 导出 | 导出为JSON | 备份或分享配置 |
| 导入（合并） | 导入JSON | 合并其他配置 |
| 检查音频 | 检查音频前缀 | 发现缺失的音频 |
| 打开音频目录 | 打开文件夹 | 快速访问音频 |
| 保存并热更新 | 保存配置 | 立即生效 |

---

## 配置步骤

### 第1步：新建分类

1. 点击 **新建分类** 按钮
2. 输入分类名（例如：`价格`、`尺寸`、`售后`）
3. 点击 **确定**

### 第2步：配置必含词

1. 在左侧选中刚创建的分类
2. 点击右侧 **必含词** 标签页
3. 点击 **批量添加**
4. 输入关键词（支持换行、逗号、中文逗号分隔）
5. 点击 **确定**

**示例**：
```
多少钱
价格
多少
费用
```

### 第3步：配置意图词（可选）

1. 点击 **意图词** 标签页
2. 点击 **批量添加**
3. 输入意图词
4. 点击 **确定**

**示例**：
```
便宜
贵
优惠
折扣
```

### 第4步：配置排除词（可选）

1. 点击 **排除词** 标签页
2. 点击 **批量添加**
3. 输入排除词
4. 点击 **确定**

**示例**：
```
不要
别
不
没有
```

### 第5步：配置回复词（可选）

1. 点击 **回复词** 标签页
2. 点击 **批量添加**
3. 输入回复文案
4. 点击 **确定**

**示例**：
```
这款产品现在有优惠，原价999，现在只需599
我们的产品质量有保证，用过的都说好
```

### 第6步：保存并生效

1. 点击 **保存并热更新** 按钮
2. 系统会保存配置到 `keywords.py`
3. 配置立即生效，无需重启

---

## 匹配规则

### 触发条件

关键词触发需要满足以下条件：

```
触发 = (必含词 ∩ 弹幕) ∧ ¬(排除词 ∩ 弹幕)
```

**用人话说**：
- 弹幕中必须包含"必含词"中的至少一个词
- 弹幕中不能包含"排除词"中的任何词

### 匹配示例

**配置**：
- 必含词：`多少钱、价格`
- 排除词：`不要、别`

| 弹幕 | 是否触发 | 原因 |
|------|--------|------|
| 这个多少钱？ | ✅ 是 | 包含"多少钱" |
| 价格怎么样？ | ✅ 是 | 包含"价格" |
| 不要这个 | ❌ 否 | 包含排除词"不要" |
| 别问价格 | ❌ 否 | 包含排除词"别" |
| 这个怎么卖？ | ❌ 否 | 不包含必含词 |

---

## 高级用法

### 批量导入配置

如果你有现成的关键词配置（JSON格式），可以快速导入：

1. 点击 **导入（合并）** 按钮
2. 选择JSON文件
3. 系统会自动合并，避免重复

**JSON格式示例**：
```json
{
  "价格": {
    "priority": 0,
    "must": ["多少钱", "价格"],
    "any": ["便宜", "贵"],
    "deny": ["不要", "别"],
    "reply": ["这款产品现在有优惠..."],
    "prefix": "价格"
  },
  "尺寸": {
    "priority": 0,
    "must": ["尺寸", "大小"],
    "any": [],
    "deny": [],
    "reply": ["我们有多种尺寸..."],
    "prefix": "尺寸"
  }
}
```

### 导出配置

1. 点击 **导出** 按钮
2. 选择保存位置
3. 系统会导出为JSON文件
4. 可用于备份或分享

### 检查音频前缀

1. 点击 **检查音频** 按钮
2. 系统会对比关键词分类和音频文件夹
3. 显示缺失的音频或多余的音频

**检查结果示例**：
```
以下分类缺少对应音频：
售后、退货

检测到新音频前缀（关键词未配置）：
新产品、限时优惠
```

---

## 常见配置模板

### 电商直播

```
分类：价格
必含词：多少钱、价格、多少、费用、成本
意图词：便宜、贵、优惠、折扣
排除词：不要、别、没有

分类：尺寸
必含词：尺寸、大小、多大、长度、宽度
意图词：大、小、合适
排除词：不要、别

分类：材质
必含词：材质、什么做的、成分、原料
意图词：质量、好、差
排除词：不要、别

分类：售后
必含词：售后、保修、退货、换货、保证
意图词：问题、坏、不好
排除词：不要、别
```

### 知识付费直播

```
分类：课程内容
必含词：课程、学什么、怎么学、内容
意图词：讲解、教、学
排除词：不要、别

分类：价格优惠
必含词：多少钱、价格、优惠、折扣
意图词：便宜、贵
排除词：不要、别

分类：报名方式
必含词：怎么报名、如何参加、报名、加入
意图词：参加、学习
排除词：不要、别
```

---

## 优化建议

### 1. 避免过度匹配

**❌ 不好的配置**：
```
必含词：的、了、吗
```
这样会导致几乎所有弹幕都触发。

**✅ 好的配置**：
```
必含词：多少钱、价格、费用
```

### 2. 使用排除词提高精度

**❌ 不好的配置**：
```
必含词：好
```
会误触发"不好"、"没好"等负面评论。

**✅ 好的配置**：
```
必含词：好
排除词：不、没、别、没有
```

### 3. 合理使用意图词

**❌ 不好的配置**：
```
必含词：空
意图词：空
```
意图词应该是辅助，不是重复。

**✅ 好的配置**：
```
必含词：多少钱
意图词：便宜、贵、优惠
```

### 4. 定期检查和优化

- 每周查看触发日志
- 发现误触发的关键词
- 及时调整排除词
- 删除无用的分类

---

## 故障排查

### 关键词没有触发

**可能原因**：
1. 弹幕监听开关未打开
2. 关键词配置有误
3. 观众弹幕不匹配

**解决方案**：
1. 进入 **AI工作台** 确认 **弹幕监听** 开关已打开
2. 使用本地弹幕测试验证配置
3. 检查必含词是否正确

### 关键词误触发

**可能原因**：
1. 排除词配置不完整
2. 必含词过于宽泛

**解决方案**：
1. 添加更多排除词
2. 使用更具体的必含词
3. 查看触发日志，找出误触发的弹幕

### 配置保存失败

**可能原因**：
1. 文件权限问题
2. 磁盘空间不足
3. 系统异常

**解决方案**：
1. 检查 `keywords.py` 文件权限
2. 检查磁盘空间
3. 重启软件后重试

---

## 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+S` | 保存并热更新 |
| `Delete` | 删除选中词条 |
| `Ctrl+A` | 全选词条 |

---

## 更多帮助

- 📖 [快速开始](./quick-start.md)
- 🎯 [AI工作台](./workbench.md)
- 🤖 [AI回复配置](./ai-reply.md)
- 💬 [评论管理](./comment-manager.md)
