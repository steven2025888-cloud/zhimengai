# AI回复

AI回复功能让系统能够使用AI模型自动改写和优化回复文案，提升转化效果。

## 功能说明

### 什么是AI回复？

当观众触发关键词时，系统不是直接发送预设的回复文案，而是：
1. 从关键词回复词中随机选择一句
2. 交给AI模型进行改写和优化
3. 发送改写后的文案

### 为什么要用AI回复？

- **提升质量** - AI改写让文案更自然、更有说服力
- **避免重复** - 每次都是不同的表述
- **提高转化** - 优化的文案更容易促成下单
- **节省时间** - 无需手动改写每条回复

---

## 配置步骤

### 第1步：获取API Key

1. 点击 **注册网址** 按钮
2. 进入AI服务平台
3. 注册账号并充值
4. 获取API Key

### 第2步：保存API Key

1. 复制你的API Key
2. 粘贴到 **API Key** 输入框
3. 点击 **保存Key** 按钮
4. 系统会保存到本地

### 第3步：测试API Key

1. 点击 **测试请求** 按钮
2. 系统会发送测试请求
3. 查看返回结果
4. 如果成功，会显示 ✅ 测试成功

**测试成功示例**：
```
✅ 测试成功（HTTP 200）
模型回复：你好！有什么我可以帮助你的吗？

原始返回：
{
  "choices": [
    {
      "message": {
        "content": "你好！有什么我可以帮助你的吗？"
      }
    }
  ]
}
```

### 第4步：选择AI模型

1. 在 **选择AI模型** 下拉框中选择模型
2. 点击 **保存模型** 按钮
3. 系统会记住你的选择

### 第5步：启用AI改写

1. 勾选 **启用 AI 改写回复** 复选框
2. 点击 **保存** 按钮
3. 系统会在触发关键词时使用AI改写

---

## 可用的AI模型

### 推荐模型

| 模型 | 特点 | 适用场景 |
|------|------|--------|
| gpt-5-mini | 极速、便宜 | 日常回复、快速响应 |
| gpt-4o-mini | 高性价比 | 平衡质量和成本 |
| gpt-4.1-mini | 稳定可靠 | 重要回复、需要稳定性 |
| gpt-4.1 | 高质量 | 复杂改写、需要高质量 |
| gpt-4o | 旗舰模型 | 最高质量、不考虑成本 |

### 如何选择？

- **新手** - 推荐 `gpt-5-mini`（快速、便宜）
- **日常使用** - 推荐 `gpt-4o-mini`（性价比最好）
- **追求质量** - 推荐 `gpt-4.1` 或 `gpt-4o`

---

## 工作流程

### 启用AI改写后的流程

```
观众弹幕
    ↓
关键词匹配
    ↓
从回复词中随机选择一句
    ↓
发送给AI模型改写
    ↓
AI返回改写后的文案
    ↓
发送改写后的文案到直播间
```

### 示例

**原始回复词**：
```
这款产品现在有优惠，原价999，现在只需599
```

**AI改写后**：
```
亲爱的朋友，这款产品质量超好，原价999元，现在限时优惠只需599元，性价比超高，赶紧下单吧！
```

---

## 高级设置

### API配置

如果你使用的是自定义API服务，可以在 `config.py` 中配置：

```python
# API主机
AI_API_HOST = "ai.zhimengai.xyz"

# API路径
AI_API_PATH = "/v1/chat/completions"

# 注册网址
AI_KEY_REGISTER_URL = "https://ai.zhimengai.xyz/console/token"

# 帮助文档
AI_REPLY_HELP_URL = "https://你的AI回复说明文档"
```

### 模型配置

在 `config.py` 中配置可用的模型：

```python
AI_REPLY_MODELS = [
    {"label": "极速 · gpt-5-mini", "id": "gpt-5-mini", "icon": "img/Deepseek.svg"},
    {"label": "高性价比 · gpt-4o-mini", "id": "gpt-4o-mini", "icon": "img/openai.svg"},
    {"label": "稳定 · gpt-4.1-mini", "id": "gpt-4.1-mini", "icon": "img/openai.svg"},
]
```

---

## 常见问题

### Q: API Key是什么？

A: API Key是你的身份凭证，用于调用AI服务。类似于密码，请妥善保管。

### Q: 如何获取API Key？

A: 
1. 点击 **注册网址** 按钮
2. 进入AI服务平台
3. 注册账号
4. 在控制台获取API Key

### Q: API Key会被上传吗？

A: 不会。API Key保存在本地，只在调用API时使用。

### Q: 测试请求失败怎么办？

A: 
1. 检查API Key是否正确
2. 检查网络连接
3. 检查API服务是否正常
4. 查看错误信息

### Q: 如何修改API Key？

A: 
1. 在 **API Key** 输入框中输入新的Key
2. 点击 **保存Key** 按钮
3. 点击 **测试请求** 验证

### Q: 如何修改AI模型？

A: 
1. 在 **选择AI模型** 下拉框中选择新模型
2. 点击 **保存模型** 按钮

### Q: AI改写会增加成本吗？

A: 会。每次改写都会调用API，产生费用。建议：
- 选择便宜的模型（如 gpt-5-mini）
- 只在重要回复时启用
- 定期检查API使用情况

### Q: 如何关闭AI改写？

A: 
1. 取消勾选 **启用 AI 改写回复** 复选框
2. 点击 **保存** 按钮
3. 系统会恢复使用原始回复词

---

## 最佳实践

### 1. 准备高质量的回复词

AI改写的质量取决于原始回复词的质量。

**✅ 好的回复词**：
```
这款产品质量超好，原价999，现在只需599，性价比超高
我们的产品用过的都说好，现在有优惠，赶紧下单
```

**❌ 不好的回复词**：
```
便宜
好
优惠
```

### 2. 定期检查改写效果

- 查看AI改写后的文案是否合适
- 如果效果不好，调整原始回复词
- 尝试不同的AI模型

### 3. 合理控制成本

- 选择性价比最好的模型
- 不是所有回复都需要AI改写
- 定期检查API使用情况

### 4. 保护API Key

- 不要分享API Key
- 定期更换API Key
- 如果泄露，立即更换

---

## 故障排查

### 测试请求失败

**可能原因**：
1. API Key错误
2. 网络连接失败
3. API服务异常
4. 账户余额不足

**解决方案**：
1. 检查API Key是否正确
2. 检查网络连接
3. 查看错误信息
4. 检查账户余额

### AI改写没有生效

**可能原因**：
1. 未启用AI改写
2. 关键词没有触发
3. 回复词为空

**解决方案**：
1. 确认 **启用 AI 改写回复** 已勾选
2. 使用本地弹幕测试
3. 检查关键词配置

### 改写文案质量不好

**可能原因**：
1. 原始回复词质量差
2. AI模型不合适
3. 提示词不够清晰

**解决方案**：
1. 改进原始回复词
2. 尝试其他AI模型
3. 查看改写结果，手动调整

---

## 成本估算

### 按模型计算

| 模型 | 单次成本 | 月成本（1000次） |
|------|--------|-----------------|
| gpt-5-mini | ¥0.001 | ¥1 |
| gpt-4o-mini | ¥0.003 | ¥3 |
| gpt-4.1-mini | ¥0.005 | ¥5 |
| gpt-4.1 | ¥0.01 | ¥10 |
| gpt-4o | ¥0.02 | ¥20 |

**注**：以上为参考价格，实际价格以API服务商为准。

---

## 更多帮助

- 📖 [快速开始](./quick-start.md)
- 🎯 [关键词设置](./keywords.md)
- 🎙️ [AI工作台](./workbench.md)
